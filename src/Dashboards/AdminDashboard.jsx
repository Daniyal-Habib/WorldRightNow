import { useContext, useEffect, useState } from "react";
import { useNavigate } from "react-router-dom";
import { approveBlog, deletePostAdmin, getSubmittedPosts } from "../Api/Api";
import Button from "@mui/material/Button";
import Dialog from "@mui/material/Dialog";
import DialogActions from "@mui/material/DialogActions";
import DialogContent from "@mui/material/DialogContent";
import DialogContentText from "@mui/material/DialogContentText";
import DialogTitle from "@mui/material/DialogTitle";
import moment from "moment";
import { UserContext } from "../Context/Context";
import AdminPosts from "./AdminPosts";
const AdminDashboard = () => {
  const [refresh, setRefreh] = useState(false);
  const [adminPosts, setAdminPosts] = useState(false);
  const [open, setOpen] = useState(false);
  const [id, setId] = useState("");
  const navigate = useNavigate();
  const [blog, setBlog] = useState([]);
  const getData = () => {
    getSubmittedPosts().then((res) => {
      setBlog(res.data);
    });
  };
  const { setAdmin } = useContext(UserContext);
  useEffect(() => {
    document.title = "Dashboard";
    getData();
  }, [refresh]);

  return !adminPosts ? (
    <div className="dashboardContainer paddingtop">
      <a
        className="switchAccount primaryButton"
        onClick={() => setAdminPosts(true)}
      >
        My Blogs
      </a>

      <h3 className="dashboardTitle">Dashboard</h3>
      <Dialog
        open={open}
        onClose={() => setOpen(false)}
        aria-labelledby="alert-dialog-title"
        aria-describedby="alert-dialog-description"
      >
        <DialogTitle id="alert-dialog-title">{"Deleting Blog"}</DialogTitle>
        <DialogContent>
          <DialogContentText id="alert-dialog-description">
            Are you sure you want to delete this blog?
          </DialogContentText>
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setOpen(false)}>No</Button>
          <Button
            onClick={() =>
              deletePostAdmin(id).then(() => {
                setOpen(false);
                setRefreh(!refresh);
              })
            }
            autoFocus
          >
            Yes
          </Button>
        </DialogActions>
      </Dialog>
      {blog.length > 0 ? (
        blog.map((blogs, index) => {
          const approve_Blog = () => {
            approveBlog(blogs._id).then(() => {
              setRefreh(!refresh);
            });
          };
          let wordsPerMinute = 150;
          let noOfWords = blogs.body.split(" ").length;
          let readingTime = noOfWords / wordsPerMinute;
          let round = Math.floor(readingTime);
          return (
            <div className="blogsContainer" key={index}>
              <div className="blogCard">
                <div className="blogInfo">
                  <div
                    className="blogTitleDescription"
                    onClick={() => navigate(`/blogs/blog/${blogs._id}`)}
                  >
                    <h2>{blogs.title}</h2>
                    <p>{blogs.description}</p>
                  </div>
                  <div className="blogStatusDateTime">
                    {blogs.approved === false ? (
                      <span className="status underreview">
                        Waiting for Approval
                      </span>
                    ) : (
                      <span className="status active">Active</span>
                    )}
                    <div className="dateTime">
                      <p> {moment(blogs.CreatedAt).fromNow()}</p>
                      <p>&nbsp;|&nbsp;</p>
                      {round <= 0 ? <p>Quick read</p> : <p>{round}mins read</p>}
                    </div>
                  </div>
                </div>
                <div className="blogOptionsStats">
                  <div className="blogOptions">
                    <div
                      className="delete"
                      style={{ cursor: "pointer" }}
                      onClick={() => {
                        setId(blogs._id);
                        setOpen(true);
                      }}
                    >
                      <svg
                        width="22"
                        height="25"
                        viewBox="0 0 22 25"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M8.42074 0.0566493C7.93175 0.213126 7.58946 0.511409 7.34497 0.980839C7.24228 1.18132 7.20805 1.32802 7.18849 1.69965L7.15915 2.16419L4.44526 2.18864L1.73137 2.21309L1.39885 2.37446C0.582241 2.77543 0.0834716 3.69962 0.235058 4.54557C0.386645 5.40619 1.10057 6.15924 1.88295 6.27659L2.09811 6.30593V14.7997C2.09811 20.7262 2.11278 23.3814 2.1519 23.5819C2.25458 24.1492 2.61644 24.6186 3.13966 24.8582L3.44283 25H10.8266H18.2103L18.489 24.868C18.846 24.7017 19.159 24.3888 19.3399 24.0171L19.4817 23.7286L19.5061 14.9904L19.5306 6.25215L19.8386 6.09567C20.6357 5.69959 21.1247 4.7754 20.978 3.93923C20.8557 3.24975 20.4303 2.68252 19.8142 2.37446L19.4817 2.21309L16.7678 2.18864L14.0539 2.16419L14.0246 1.69965C14.005 1.29379 13.9757 1.19599 13.8339 0.92705C13.6432 0.565198 13.384 0.315814 13.0075 0.139777L12.7336 0.0126402L10.6799 0.00286046C9.07599 -0.00691933 8.58211 0.00775035 8.42074 0.0566493ZM12.6163 1.40137C12.7434 1.5334 12.7581 1.57741 12.7581 1.86591V2.18864H10.6065H8.45497V1.86591C8.45497 1.57741 8.46964 1.5334 8.59678 1.40137L8.73859 1.25956H10.6065H12.4745L12.6163 1.40137ZM19.3937 3.58715C19.8435 3.92456 19.8289 4.59936 19.3594 4.91231L19.1981 5.02478H10.6065H2.01498L1.84872 4.91231C1.61401 4.76073 1.44286 4.39888 1.48687 4.14949C1.53088 3.88544 1.69225 3.65072 1.90251 3.54314C2.06388 3.46491 2.55776 3.46002 10.6652 3.4698L19.2567 3.48447L19.3937 3.58715ZM18.225 14.9024L18.2103 23.5037L18.0978 23.6162L17.9854 23.7286L10.8852 23.7433C5.78509 23.7531 3.746 23.7384 3.65309 23.6993C3.34992 23.577 3.36948 24.1492 3.36948 14.8437C3.36948 10.1787 3.38415 6.34505 3.40371 6.33038C3.41838 6.31082 6.76307 6.29615 10.8364 6.29615H18.2348L18.225 14.9024Z"
                          fill="black"
                        />
                        <path
                          d="M6.51372 8.73621C6.12742 8.91225 6.15676 8.41837 6.15676 15.0246C6.15676 21.538 6.1372 21.1076 6.46482 21.3081C6.76311 21.4939 7.16897 21.3766 7.34011 21.0587C7.42324 20.9023 7.42813 20.6187 7.42813 15.0491C7.42813 9.58216 7.42324 9.19586 7.34011 9.03939C7.17386 8.70198 6.84624 8.58463 6.51372 8.73621Z"
                          fill="black"
                        />
                        <path
                          d="M10.6355 8.6922C10.5622 8.71665 10.4546 8.77533 10.4008 8.82423C10.1563 9.03939 10.1661 8.8389 10.1661 15.0588C10.1661 20.6187 10.171 20.9023 10.2541 21.0587C10.4252 21.3766 10.8311 21.4939 11.1294 21.3081C11.457 21.1076 11.4374 21.538 11.4374 15.0197C11.4374 9.18608 11.4374 9.11762 11.3396 8.96115C11.281 8.86335 11.1587 8.77044 11.0463 8.72154C10.8262 8.63352 10.8311 8.63352 10.6355 8.6922Z"
                          fill="black"
                        />
                        <path
                          d="M14.6158 8.70687C14.5229 8.7411 14.4006 8.8389 14.3371 8.93181L14.2246 9.09807V15.0491V21.0001L14.3273 21.1321C14.4544 21.2935 14.6647 21.4059 14.8456 21.4059C15.0217 21.4059 15.271 21.2543 15.3835 21.0783C15.4666 20.9512 15.4715 20.648 15.4715 15.0246C15.4715 9.45014 15.4666 9.09807 15.3835 8.97093C15.2173 8.71176 14.9092 8.60419 14.6158 8.70687Z"
                          fill="black"
                        />
                      </svg>
                      Delete
                    </div>
                    <div
                      className="edit"
                      style={{ cursor: "pointer" }}
                      onClick={approve_Blog}
                    >
                      <svg
                        width="25"
                        height="25"
                        viewBox="0 0 25 25"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M11.259 0.0481884C8.83315 0.293563 6.39613 1.32525 4.4666 2.93134C1.37153 5.49662 -0.318211 9.58992 0.0498511 13.6219C0.529447 18.864 4.30487 23.3142 9.36294 24.6024C10.5452 24.9035 11.2925 24.9928 12.5417 24.9872C14.0529 24.9816 15.2575 24.7808 16.6405 24.3012C17.6276 23.9555 19.3675 23.0353 19.7468 22.6561C20.1148 22.2881 19.8583 21.669 19.3285 21.669C19.1947 21.669 19.005 21.7583 18.6593 21.9869C16.1777 23.6042 13.1551 24.1674 10.1716 23.5707C8.53201 23.2417 6.69728 22.3661 5.34771 21.2675C1.03693 17.7542 -0.0672596 11.5585 2.75455 6.75696C5.37002 2.3179 10.6958 0.204336 15.6646 1.63197C19.9531 2.86442 23.1374 6.57292 23.7229 11.0176C23.8177 11.7481 23.8345 13.1367 23.7452 13.8171C23.5389 15.5235 22.931 17.2077 22.0276 18.6074C21.7711 19.0034 21.6874 19.1874 21.6874 19.338C21.6874 19.7284 22.0444 19.996 22.4347 19.8901C22.5964 19.8455 22.6857 19.7562 22.9087 19.4328C23.9293 17.9104 24.5985 16.176 24.8996 14.2353C25.0335 13.3709 25.0335 11.67 24.8996 10.7778C24.0687 5.23452 19.8583 0.979497 14.3541 0.126262C13.6626 0.0203049 11.9673 -0.0243087 11.259 0.0481884Z"
                          fill="black"
                        />
                        <path
                          d="M11.5376 2.41833C11.4595 2.42949 11.2086 2.46852 10.9799 2.50198C9.94822 2.64698 8.67116 3.06523 8.4704 3.31618C8.30867 3.52252 8.3254 3.84039 8.49828 4.04673C8.71577 4.30883 8.86634 4.30883 9.61362 4.06346C11.4651 3.45002 13.205 3.40541 15.0119 3.92404C17.276 4.56536 19.2725 6.20491 20.4213 8.35194C21.8768 11.0789 21.7541 14.5588 20.1145 17.191C17.3987 21.5353 11.7551 22.7398 7.48332 19.8846C6.79739 19.4217 5.82146 18.4904 5.33629 17.8323C3.81385 15.7634 3.25061 13.2148 3.76366 10.6997C3.80828 10.4655 3.94769 9.97476 4.07038 9.6067C4.31576 8.85942 4.31576 8.70885 4.05365 8.49136C3.84731 8.31848 3.52944 8.30175 3.3231 8.46348C3.08331 8.65308 2.73197 9.69035 2.52006 10.8336C2.40295 11.4749 2.36391 12.8914 2.44199 13.594C2.77659 16.4828 4.2823 19.0592 6.63566 20.7489C7.2491 21.1895 8.62097 21.8866 9.33478 22.1208C11.3814 22.7844 13.601 22.7844 15.6532 22.1208C20.5551 20.5259 23.494 15.412 22.401 10.3596C22.2225 9.52305 21.9939 8.89288 21.5478 7.98946C21.0459 6.98007 20.5718 6.30529 19.7967 5.49667C18.3133 3.94635 16.367 2.90351 14.2702 2.52429C13.7683 2.43506 11.8722 2.35699 11.5376 2.41833Z"
                          fill="black"
                        />
                        <path
                          d="M16.2224 7.78871C15.8153 7.92255 15.4863 8.21254 13.2389 10.4655L10.8465 12.8635L10.1104 12.1385C9.20138 11.2518 8.95601 11.1124 8.27565 11.118C7.93547 11.118 7.76817 11.1459 7.57299 11.2463C7.17704 11.4359 6.8759 11.7203 6.70302 12.0772C6.56918 12.3449 6.54688 12.4676 6.54688 12.8412C6.54688 13.6275 6.55803 13.6442 8.23661 15.334C9.99327 17.1018 10.0379 17.1353 10.813 17.1353C11.2592 17.1353 11.3819 17.1129 11.5994 17.0014C11.789 16.9066 12.7816 15.9474 15.0681 13.6554C18.6539 10.0584 18.4866 10.2703 18.4754 9.46729C18.4754 8.97654 18.3527 8.6531 18.0293 8.29619C17.7058 7.93928 17.3434 7.77755 16.808 7.76082C16.5626 7.74967 16.3005 7.76082 16.2224 7.78871ZM17.0757 9.02116C17.2709 9.17731 17.3657 9.48402 17.2876 9.68478C17.2486 9.76844 15.8377 11.2184 14.1423 12.9137C11.3261 15.7299 11.0473 15.992 10.88 15.992C10.7796 15.992 10.629 15.9586 10.5454 15.914C10.3669 15.8136 7.84067 13.2818 7.75144 13.1089C7.5451 12.7074 7.96893 12.1776 8.40949 12.2835C8.49314 12.3058 8.96159 12.7241 9.53041 13.2873C10.3335 14.0792 10.5454 14.2577 10.7127 14.2911C10.8354 14.3134 10.9636 14.3023 11.0417 14.2633C11.1142 14.2242 12.3689 13.0085 13.8245 11.553C16.4567 8.92635 16.479 8.90962 16.702 8.90962C16.847 8.90962 16.9865 8.94866 17.0757 9.02116Z"
                          fill="black"
                        />
                        <path
                          d="M20.634 20.4198C20.2548 20.6317 20.266 21.2675 20.6563 21.4459C20.9184 21.5686 21.1248 21.5296 21.3311 21.3233C21.8219 20.8325 21.2419 20.0852 20.634 20.4198Z"
                          fill="black"
                        />
                      </svg>
                      Approve
                    </div>
                  </div>
                  <div className="blogStats">
                    <div className="views">
                      <svg
                        width="22"
                        height="16"
                        viewBox="0 0 22 16"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M11 0.5C6 0.5 1.73 3.61 0 8C1.73 12.39 6 15.5 11 15.5C16 15.5 20.27 12.39 22 8C20.27 3.61 16 0.5 11 0.5ZM11 13C8.24 13 6 10.76 6 8C6 5.24 8.24 3 11 3C13.76 3 16 5.24 16 8C16 10.76 13.76 13 11 13ZM11 5C9.34 5 8 6.34 8 8C8 9.66 9.34 11 11 11C12.66 11 14 9.66 14 8C14 6.34 12.66 5 11 5Z"
                          fill="black"
                        />
                      </svg>
                      {blogs.views}
                    </div>
                    <div className="comments">
                      <svg
                        width="20"
                        height="20"
                        viewBox="0 0 20 20"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          fill-rule="evenodd"
                          clip-rule="evenodd"
                          d="M0 3.5C0 2.70435 0.316071 1.94129 0.87868 1.37868C1.44129 0.816071 2.20435 0.5 3 0.5H17C17.7956 0.5 18.5587 0.816071 19.1213 1.37868C19.6839 1.94129 20 2.70435 20 3.5V13.5C20 14.2956 19.6839 15.0587 19.1213 15.6213C18.5587 16.1839 17.7956 16.5 17 16.5H5.667C5.45063 16.5 5.2401 16.5702 5.067 16.7L1.6 19.3C1.45143 19.4114 1.27477 19.4793 1.08981 19.496C0.904844 19.5126 0.718892 19.4775 0.552786 19.3944C0.386681 19.3114 0.246984 19.1837 0.149349 19.0257C0.0517147 18.8678 0 18.6857 0 18.5V3.5ZM5 3.5C4.73478 3.5 4.48043 3.60536 4.29289 3.79289C4.10536 3.98043 4 4.23478 4 4.5C4 4.76522 4.10536 5.01957 4.29289 5.20711C4.48043 5.39464 4.73478 5.5 5 5.5H15C15.2652 5.5 15.5196 5.39464 15.7071 5.20711C15.8946 5.01957 16 4.76522 16 4.5C16 4.23478 15.8946 3.98043 15.7071 3.79289C15.5196 3.60536 15.2652 3.5 15 3.5H5ZM5 7.5C4.73478 7.5 4.48043 7.60536 4.29289 7.79289C4.10536 7.98043 4 8.23478 4 8.5C4 8.76522 4.10536 9.01957 4.29289 9.20711C4.48043 9.39464 4.73478 9.5 5 9.5H15C15.2652 9.5 15.5196 9.39464 15.7071 9.20711C15.8946 9.01957 16 8.76522 16 8.5C16 8.23478 15.8946 7.98043 15.7071 7.79289C15.5196 7.60536 15.2652 7.5 15 7.5H5ZM5 11.5C4.73478 11.5 4.48043 11.6054 4.29289 11.7929C4.10536 11.9804 4 12.2348 4 12.5C4 12.7652 4.10536 13.0196 4.29289 13.2071C4.48043 13.3946 4.73478 13.5 5 13.5H9C9.26522 13.5 9.51957 13.3946 9.70711 13.2071C9.89464 13.0196 10 12.7652 10 12.5C10 12.2348 9.89464 11.9804 9.70711 11.7929C9.51957 11.6054 9.26522 11.5 9 11.5H5Z"
                          fill="black"
                        />
                      </svg>
                      {blogs.commentslength}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          );
        })
      ) : (
        <>no blogs yet</>
      )}
    </div>
  ) : (
    <AdminPosts setAdminPosts={setAdminPosts} />
  );
};

export default AdminDashboard;
